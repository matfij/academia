@using Microsoft.Maui.Controls
@using SkiaSharp
@using SkiaSharp.Views.Maui
@using MauiSkiaSharp.Services;

@inject ParticleService particleService;

@code {
    private SKCanvasView CanvasView = new()
        {
            WidthRequest = 1000,
            HeightRequest = 600,
        };

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            SetupCanvas();
        }
    }

    private void SetupCanvas()
    {
        CanvasView.PaintSurface += OnPaintSurface;
        var contentPage = Application.Current?.MainPage as ContentPage;
        if (contentPage != null)
        {
            contentPage.Content = CanvasView;
        }
    }

    private void OnPaintSurface(object? sender, SKPaintSurfaceEventArgs args)
    {
        var canvas = args.Surface.Canvas;
        canvas.Clear(SKColors.Black);

        using var paint = new SKPaint { Color = SKColors.White, IsAntialias = true };


        foreach (var particle in particleService.GetParticles)
        {
            canvas.DrawCircle(particle.X, particle.Y, particle.R, paint);
        }
    }
}
